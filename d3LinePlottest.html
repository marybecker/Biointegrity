<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>d3PlotTest</title>
</head>
<body>

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v5.js"></script>

<!-- Create a div where the graph will take place -->
<div id="linePlot"></div>

<script>

    //Read the data
    d3.csv('data/BCG_OverTime.csv')
        .then(function(data) {
            console.log(data);
            drawPlot(data,linePlot);
        })
        .catch(function(error){
            // handle error
        });


    // Now I can use this dataset:
    function drawPlot(data,id) {

        // set the dimensions and margins of the graph
        var margin = {top: 10, right: 30, bottom: 50, left: 60},
            width = 500 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        // append the svg object to the body of the page
        var svg = d3.select(id)
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");

        var plotData = data[6];
        console.log(plotData);

        var yearIndex = [1,2,3,4,5,6,1,2,3,4,5,6,1,2,3,4,5,6];
        // var xdata = ["1990", "1995", "2000", "2005","2010","2015","1990", "1995", "2000", "2005","2010","2015",
        //             "1990", "1995", "2000", "2005","2010","2015"];
        console.log(yearIndex);
        var RA = [plotData.T5Yr1,plotData.T5Yr2,plotData.T5Yr3,plotData.T5Yr4,plotData.T5Yr5,plotData.T5Yr6,
                    plotData.T4Yr1,plotData.T4Yr2,plotData.T4Yr3,plotData.T4Yr4,plotData.T4Yr5,plotData.T4Yr6,
                    plotData.T2Yr1,plotData.T2Yr2,plotData.T2Yr3,plotData.T2Yr4,plotData.T2Yr5,plotData.T2Yr6];
        console.log(RA);
        var cat = ["Tol","Tol","Tol","Tol","Tol","Tol","Mod","Mod","Mod","Mod","Mod","Mod","Sen","Sen","Sen",
                    "Sen","Sen","Sen"];

        var xy = [];
        for(var i=0;i<yearIndex.length;i++){
            xy.push({x:yearIndex[i],y:RA[i],z:cat[i]});
        }

        var clean_xy = [];
        var dirty_xy = [];
        for(var i=0; i<xy.length; i++) {
            if (xy[i].x != 'null' && xy[i].y != 'null') {
                clean_xy.push(xy[i]);
            } else {
                dirty_xy.push(xy[i]);
            }
        }
        console.log(xy);
        console.log(clean_xy);
        console.log(dirty_xy);

        var Tol = [];
        var Mod = [];
        var Sen = [];
        for(var i=0; i<clean_xy.length; i++){
            if (clean_xy[i].z == 'Tol'){
                Tol.push(clean_xy[i]);
            }
            if(clean_xy[i].z == 'Mod'){
                Mod.push(clean_xy[i]);
            }
            if(clean_xy[i].z == 'Sen'){
                Sen.push(clean_xy[i]);
            }
        }
        console.log(Tol);
        console.log(Mod);
        console.log(Sen);

        var xscale = d3.scaleOrdinal()
            .domain([0,1,2,3,4,5,6])
            .range([0,1*width/6,2*width/6,3*width/6,4*width/6,5*width/6,width]);

        var xAxis = d3.axisBottom(xscale)
            .tickValues(["","1989 - 1995", "1996-2000", "2001-2005", "2006-2010","2011-2015","2016-2017"]);
        svg.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(xAxis);

        // Add Y axis
        var yscale = d3.scaleLinear()
            .domain([0, 100])
            .range([ height, 0 ]);
        svg.append("g")
            .call(d3.axisLeft(yscale));

        // Add the line
        svg.append("path")
            .datum(Tol)
            .attr("fill", "none")
            .attr("stroke", "#B39DDB")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function(d) { return xscale(d.x) })
                .y(function(d) { return yscale(d.y*100) })
            );

        svg.append("path")
            .datum(Mod)
            .attr("fill", "none")
            .attr("stroke", "#f9711d")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function(d) { return xscale(d.x) })
                .y(function(d) { return yscale(d.y*100) })
            );

        svg.append("path")
            .datum(Sen)
            .attr("fill", "none")
            .attr("stroke", "#008837")
            .attr("stroke-width", 1.5)
            .attr("d", d3.line()
                .x(function(d) { return xscale(d.x) })
                .y(function(d) { return yscale(d.y*100) })
            );


        // Add the points
        svg.append("g")
            .selectAll("dot")
            .data(Tol)
            .enter()
            .append("circle")
            .attr("cx", function(d) { return xscale(d.x) } )
            .attr("cy", function(d) { return yscale(d.y*100) } )
            .attr("r", 5)
            .attr("fill", "#B39DDB");
            /*.filter(function(d) {
                return d.y == 'null';
            })
                .remove();*/
        // Add the points
        svg.append("g")
            .selectAll("dot")
            .data(Mod)
            .enter()
            .append("circle")
            .attr("cx", function(d) { return xscale(d.x) } )
            .attr("cy", function(d) { return yscale(d.y*100) } )
            .attr("r", 5)
            .attr("fill", "#f9711d");
        // Add the points
        svg.append("g")
            .selectAll("dot")
            .data(Sen)
            .enter()
            .append("circle")
            .attr("cx", function(d) { return xscale(d.x) } )
            .attr("cy", function(d) { return yscale(d.y*100) } )
            .attr("r", 5)
            .attr("fill", "#008837");

        // text label for the x axis
        svg.append("text")
            .attr("transform", "translate(" + (width/2) + " ," + (height + margin.top + 30) + ")")
            .style("text-anchor", "middle")
            .text("Year");

        // text label for the y axis
        svg.append("text")
            .attr("transform", "rotate(-90)")
            .attr("y", 0 - margin.left)
            .attr("x",0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("Percent Relative Abundance");
    }
</script>
</body>

</html>